# Notes from porting clang-quala changes from LLVM-3.7 to current version

The clang-quala mods are based primarily on the following two commits: [Quala extensions for Clang 3.7](https://github.com/sampsyo/clang-quala/commit/cf13b5ece455999847fd8ae429fbafef4c9bbfa8#diff-062633a31cb015a4e00c5e503a80e9b7R2051) and [A couple of bug fixes for Quala port to LLVM 3.7](https://github.com/sampsyo/clang-quala/commit/859fa5352369334502a87d1fb8af27c03309de5a). Here is a detailed 
list of changes needed to port to 10.0.0.

 1. include/clang/AST/ASTContext.h: Applied mods as is
 2. include/clang/AST/DataRecursiveASTVisitor.h: Not applicable, seems to have been integrated with RecursiveASTVisitor.h
 3. include/clang/AST/RecursiveASTVisitor.h: Applied mods as is
 4. include/clang/AST/Type.h: Moved friend and added blank lines to match style of current source. Also added exception for trivially_destructible_check for AnnotatedType in lib/AST/Type.cpp -- need to check this issue
 5. include/clang/AST/TypeLoc.h: Reformatted method signature and added blank lines to match style of current source
 6. include/clang/AST/TypeNodes.def: This is now replaced by include/clang/Basic/TypeNodes.td, from which it is autogenerated, inserted 
    def AnnotatedType : Type, NeverCanonical; at end
 7. include/clang/Basic/Attr.td: Used Clang instead of GNU in spellings
 8. include/clang/Serialization/ASTBitCodes.h: Moved TYPE_ANNOTATED down to 50, as there are more types now.
 9. lib/AST/ASTContext.cpp: Placed Type::Annotated before Type::Atomic, and getAnnotatedType in same place (after getAtomicType); had to 
 10. lib/AST/ASTImporter.cpp: Relevant code is now in lib/AST/ASTStructuralEquivalence.cpp, modified that file instead, added same code chunk there with minor format modification
 11. lib/AST/ItaniumMangle.cpp: Applied mods as is
 12. lib/AST/TypePrinter.cpp: Minor formatting changes, corrected annotate_type to type_annotate. Also had to handle attr::TypeAnnotate in TypePrinter::printAttributedAfter to avoid warning on switch.
 13. lib/CodeGen/CGDebugInfo.cpp: Applied mods as is
 14. lib/CodeGen/CGTypeAnnotation.cpp: Added file as is
 15. lib/CodeGen/CMakeLists.txt: Applied mods as is
 16. lib/CodeGen/CodeGenFunction.cpp: Applied mods as is
 17. lib/CodeGen/CodeGenModule.h: Applied mods as is
 18. lib/CodeGen/CGDecl.cpp: Use address.getPointer() rather than emission.Address as code has changed
 19. lib/CodeGen/CGExprScalar.cpp: Applied mods as is
 20. lib/CodeGen/CGExpr.cpp: Added to end of EmitStoreOfScalar, but code has changed quite a bit, needs checking (also unclear what is the condition to invoke TADecorate)
 21. lib/Sema/SemaExpr.cpp: Applied mods as is
 22. lib/Sema/SemaType.cpp: There are numerous changes to the code in this file;
the changes need to be vetted carefully
 23. lib/Sema/TreeTransform.h: Applied mods as is
 24. lib/Serialization/ASTReader.cpp: ReadSourceLocation signature changed, no arguments needed
 25. lib/Serialization/ASTWriter.cpp: Writer is now replaced by Record
 26. tools/libclang/CIndex.cpp: Applied mods as is, with minor tweak to comment
